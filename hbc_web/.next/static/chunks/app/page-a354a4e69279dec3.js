(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5207:function(e,t,o){Promise.resolve().then(o.bind(o,5611))},5611:function(e,t,o){"use strict";o.d(t,{default:function(){return f}});var r=o(7437),n=o(2265);o(4868),o(8537),o(9583);var i=o(8280),l=o(891);function a(e){let{rowData:t,columnDefs:o,className:i,height:a="70vh",loading:s,error:c,gridOptions:d,rowIdField:u,onGridReady:h,onFilterChanged:p,onSortChanged:_,onSelectionChanged:m,onCellClicked:b,onCellDoubleClicked:g}=e,f=(0,n.useMemo)(()=>{var e;return o&&o.length?o:Object.keys(null!==(e=null==t?void 0:t[0])&&void 0!==e?e:{}).map(e=>({field:e}))},[o,t]),x=(0,n.useMemo)(()=>({resizable:!0,sortable:!0,unSortIcon:!0,filter:!0,floatingFilter:!0,minWidth:140}),[]),y=(0,n.useMemo)(()=>({theme:"legacy",animateRows:!0,rowSelection:"single",suppressCellFocus:!1,pagination:!1,alwaysShowHorizontalScroll:!0,suppressHorizontalScroll:!1,suppressRowClickSelection:!0,enableCellTextSelection:!0,ensureDomOrder:!0,suppressCopyRowsToClipboard:!0,...null!=d?d:{}}),[d]),v=["hbc-ag-grid ag-theme-quartz-dark w-full rounded-lg border border-[color:var(--color-border)] bg-[color:var(--color-card)]",i].filter(Boolean).join(" ");return(0,r.jsxs)("div",{className:"w-full",children:[c?(0,r.jsx)("div",{className:"mb-3 rounded-md border border-red-500/40 bg-red-500/10 px-3 py-2 text-sm text-red-200",children:c}):null,(0,r.jsx)("div",{className:v,style:{height:a},children:(0,r.jsx)(l.s,{rowData:t,columnDefs:f,defaultColDef:x,gridOptions:y,loading:s,onGridReady:h,onFilterChanged:p,onSortChanged:_,onSelectionChanged:m,onCellClicked:b,onCellDoubleClicked:g,getRowId:u?e=>{var t;let o=null===(t=e.data)||void 0===t?void 0:t[u];return"string"==typeof o&&o.length?o:"number"==typeof o?String(o):JSON.stringify(e.data)}:void 0})})]})}i.O3h.registerModules([i.ea9]);var s=o(7119);let c=s.Z_().trim().min(1).nullable().optional(),d=s.dj(e=>{if(""===e||null==e)return null;if("number"==typeof e)return Number.isFinite(e)?e:null;if("string"==typeof e){let t=Number(e);return Number.isFinite(t)?t:null}return null},s.Rx().nullable().optional()),u=s.dj(e=>{if(""===e||null==e||"string"!=typeof e)return null;let t=e.trim();return t?(Number.isNaN(Date.parse(t.includes(" ")?t.replace(" ","T"):t)),t):null},s.Z_().nullable().optional()),h=s.Ry({hbc_unique_key:s.Z_().min(1).optional(),unique_key:c,address_type:c,agency:c,agency_name:c,borough:c,bridge_highway_direction:c,bridge_highway_name:c,bridge_highway_segment:c,city:c,closed_date:u,community_board:c,complaint_type:c,created_date:u,cross_street_1:c,cross_street_2:c,descriptor:c,due_date:u,facility_type:c,ferry_direction:c,ferry_terminal_name:c,garage_lot_name:c,incident_address:c,incident_zip:c,intersection_street_1:c,intersection_street_2:c,landmark:c,latitude:d,location:c,location_type:c,longitude:d,park_borough:c,park_facility_name:c,resolution_action_updated_date:u,road_ramp:c,school_address:c,school_city:c,school_code:c,school_name:c,school_not_found:c,school_number:c,school_or_citywide_complaint:c,school_phone_number:c,school_region:c,school_state:c,school_zip:c,status:c,street_name:c,taxi_company_borough:c,taxi_pick_up_location:c,vehicle_type:c,x_coordinate_state_plane_:d,y_coordinate_state_plane_:d}).passthrough(),p=["address_type","agency","agency_name","borough","bridge_highway_direction","bridge_highway_name","bridge_highway_segment","city","closed_date","community_board","complaint_type","created_date","cross_street_1","cross_street_2","descriptor","due_date","facility_type","ferry_direction","ferry_terminal_name","garage_lot_name","incident_address","incident_zip","intersection_street_1","intersection_street_2","landmark","latitude","location","location_type","longitude","park_borough","park_facility_name","resolution_action_updated_date","road_ramp","school_address","school_city","school_code","school_name","school_not_found","school_number","school_or_citywide_complaint","school_phone_number","school_region","school_state","school_zip","status","street_name","taxi_company_borough","taxi_pick_up_location","unique_key","vehicle_type","x_coordinate_state_plane_","y_coordinate_state_plane_"];function _(){return(0,r.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:(0,r.jsx)("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}function m(){return(0,r.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:(0,r.jsx)("path",{d:"M9 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}function b(){return(0,r.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:[(0,r.jsx)("path",{d:"M18 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.jsx)("path",{d:"M12 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}function g(){return(0,r.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:[(0,r.jsx)("path",{d:"M6 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,r.jsx)("path",{d:"M12 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}function f(){let[e,t]=(0,n.useState)(1),[o,i]=(0,n.useState)({}),[l,c]=(0,n.useState)(void 0),[d,u]=(0,n.useState)(void 0),f=(0,n.useRef)(null),x=(0,n.useRef)(null),[y,v]=(0,n.useState)(0),j=(0,n.useMemo)(()=>p.map(e=>({field:e,filter:e.includes("date")?"agDateColumnFilter":"latitude"===e||"longitude"===e||e.endsWith("_coordinate_state_plane_")?"agNumberColumnFilter":"agTextColumnFilter",filterParams:e.includes("date")?{filterOptions:["equals"],defaultOption:"equals",debounceMs:300}:"latitude"===e||"longitude"===e||e.endsWith("_coordinate_state_plane_")?{filterOptions:["equals"],defaultOption:"equals",debounceMs:300}:{filterOptions:["contains","equals"],defaultOption:"contains",debounceMs:150}})),[]),[k,w]=(0,n.useState)(!1),[C,N]=(0,n.useState)({rows:[],invalidCount:0,issues:[]});(0,n.useEffect)(()=>{let t=new AbortController;return async function(){let o=(e-1)*50,r=new URLSearchParams;r.set("$top",String(50)),r.set("$skip",String(o)),r.set("$count","true"),l&&r.set("$filter",l);let n="".concat("/backend","/").concat("nyc_open_data_311_service_requests","?").concat(r.toString());w(!0);try{let e=await fetch(n,{cache:"no-store",signal:t.signal});if(!e.ok){N({rows:[],invalidCount:0,issues:[],error:"REST API error ".concat(e.status," on GET ").concat(n)});return}let o=await e.json();console.log("[hbc_web] GET ".concat(n," ->"),o);let r="object"==typeof o&&null!==o&&"value"in o?o.value:o,i=function(e){let t=s.IX(s._4()).safeParse(e);if(!t.success)return{rows:[],invalidCount:0,issues:["Response was not an array of rows."]};let o=[],r=[],n=0;for(let e=0;e<t.data.length;e++){let i=h.safeParse(t.data[e]);if(!i.success){n++,r.length<10&&r.push("Row ".concat(e+1,": ").concat(i.error.issues.map(e=>"".concat(e.path.join(".")||"(root)"," ").concat(e.message)).join("; ")));continue}o.push(i.data)}return n>r.length&&r.push("â€¦and ".concat(n-r.length," more invalid row(s).")),{rows:o,invalidCount:n,issues:r}}(r),l="object"==typeof o&&null!==o&&"count"in o&&"number"==typeof o.count?o.count:void 0;N({...i,totalCount:l})}catch(e){if(t.signal.aborted)return;N({rows:[],invalidCount:0,issues:[],error:"Failed to fetch: ".concat(e instanceof Error?e.message:String(e))})}finally{t.signal.aborted||w(!1)}}(),()=>t.abort()},[e,l]);let{rows:S,invalidCount:M,issues:L,error:F,totalCount:R}=C,O=e>1,q=50===S.length&&("number"!=typeof R||50*e<R),W="number"==typeof R?Math.max(1,Math.ceil(R/50)):void 0,T="number"==typeof W&&e<W,D=!!l||Object.keys(o).length>0;return(0,r.jsxs)("div",{className:"w-full rounded-lg border border-[color:var(--color-border)] bg-[color:var(--color-bg)] p-6 text-[color:var(--color-text)]",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("h1",{className:"text-xl font-medium text-[color:var(--color-accent)]",children:"NYC Open Data 311 Service Requests:"}),L.length?(0,r.jsxs)("div",{className:"rounded-md border border-yellow-500/30 bg-yellow-500/10 px-3 py-2 text-sm text-yellow-100",children:[(0,r.jsx)("div",{className:"font-medium",children:"Validation issues (sample)"}),(0,r.jsx)("ul",{className:"list-disc pl-5",children:L.map(e=>(0,r.jsx)("li",{children:e},e))})]}):null]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)(a,{rowData:S,columnDefs:j,error:null!=F?F:null,rowIdField:"hbc_unique_key",height:"50vh",loading:k,onGridReady:e=>{x.current=e.api},onSelectionChanged:e=>{v(e.api.getSelectedNodes().length)},onCellDoubleClicked:e=>{e.node&&(e.node.setSelected(!e.node.isSelected()),v(e.api.getSelectedNodes().length))},onFilterChanged:e=>{let o=e.api.getFilterModel();i(o),f.current&&window.clearTimeout(f.current),f.current=window.setTimeout(()=>{let e=function(e){if(!e)return;let t=[];for(let[o,r]of Object.entries(e)){let e=String(o);if(!r)continue;let n=String(r.type||"").toLowerCase();if(!n||"equals"===n||"contains"===n){if("string"==typeof r.filter){let o=r.filter.trim();if("contains"===n&&o.length<3)continue;let i=o.replace(/'/g,"''");if(!i)continue;"contains"===n?t.push("contains(".concat(e,",'").concat(i,"')")):t.push("".concat(e," eq '").concat(i,"'"));continue}if("number"==typeof r.filter&&Number.isFinite(r.filter)){t.push("".concat(e," eq ").concat(r.filter));continue}if("string"==typeof r.dateFrom&&r.dateFrom.trim()){let o="".concat(r.dateFrom.trim(),"T00:00:00");t.push("".concat(e," eq '").concat(o,"'"));continue}}}return t.length?t.join(" and "):void 0}(o);c(e),u(e),t(1)},900)},gridOptions:{rowSelection:{mode:"multiRow",enableSelectionWithoutKeys:!0,enableClickSelection:!1,checkboxes:!1,headerCheckbox:!1}}}),(0,r.jsxs)("div",{className:"mt-3 flex items-center justify-between gap-3",children:[(0,r.jsx)("div",{className:"text-sm text-[color:var(--color-muted)]",children:(()=>{let t="number"==typeof R?R:void 0,o=t?Math.max(1,Math.ceil(t/50)):void 0,n=(e-1)*50+1,i=(e-1)*50+S.length;return(0,r.jsxs)(r.Fragment,{children:["Page ",e,o?" of ".concat(o):"","; ","Rows: ",S.length?"".concat(n,"-").concat(i):"0",t?"; Total Rows ".concat(t):"",M?"; filtered ".concat(M):"",d?"; filter ".concat(d):""]})})()}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,r.jsx)("button",{type:"button","aria-disabled":!O,disabled:!O,onClick:()=>t(1),className:["inline-flex items-center justify-center rounded-md border px-2.5 py-2 text-sm","border-[color:var(--color-border)] bg-[color:var(--color-bg)] text-[color:var(--color-text)]",O?"hover:border-[color:var(--color-accent)]":"opacity-50"].join(" "),title:"First page",children:(0,r.jsx)(b,{})}),(0,r.jsx)("button",{type:"button","aria-disabled":!O,disabled:!O,onClick:()=>t(e=>Math.max(1,e-1)),className:["inline-flex items-center justify-center rounded-md border px-2.5 py-2 text-sm","border-[color:var(--color-border)] bg-[color:var(--color-bg)] text-[color:var(--color-text)]",O?"hover:border-[color:var(--color-accent)]":"opacity-50"].join(" "),title:"Previous page",children:(0,r.jsx)(_,{})}),(0,r.jsx)("button",{type:"button","aria-disabled":!q,disabled:!q,onClick:()=>t(e=>e+1),className:["inline-flex items-center justify-center rounded-md border px-2.5 py-2 text-sm","border-[color:var(--color-border)] bg-[color:var(--color-bg)] text-[color:var(--color-text)]",q?"hover:border-[color:var(--color-accent)]":"opacity-50"].join(" "),title:"Next page",children:(0,r.jsx)(m,{})}),(0,r.jsx)("button",{type:"button","aria-disabled":!T,disabled:!T,onClick:()=>{"number"==typeof W&&t(W)},className:["inline-flex items-center justify-center rounded-md border px-2.5 py-2 text-sm","border-[color:var(--color-border)] bg-[color:var(--color-bg)] text-[color:var(--color-text)]",T?"hover:border-[color:var(--color-accent)]":"opacity-50"].join(" "),title:"number"==typeof W?"Last page (".concat(W,")"):"Last page",children:(0,r.jsx)(g,{})}),(0,r.jsx)("button",{type:"button","aria-disabled":!D,disabled:!D,onClick:()=>{var e;f.current&&(window.clearTimeout(f.current),f.current=null),null===(e=x.current)||void 0===e||e.setFilterModel(null),i({}),c(void 0),u(void 0),t(1)},className:["inline-flex items-center justify-center rounded-md border px-2.5 py-2 text-sm","border-[color:var(--color-border)] bg-[color:var(--color-bg)] text-[color:var(--color-text)]",D?"hover:border-[color:var(--color-accent)]":"opacity-50"].join(" "),title:"Reset filters",children:(0,r.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:[(0,r.jsx)("path",{d:"M3 6h18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M6 12h12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M10 18h4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,r.jsx)("button",{type:"button","aria-disabled":0===y,disabled:0===y,onClick:()=>{var e;null===(e=x.current)||void 0===e||e.deselectAll(),v(0)},className:["inline-flex items-center justify-center rounded-md border px-2.5 py-2 text-sm","border-[color:var(--color-border)] bg-[color:var(--color-bg)] text-[color:var(--color-text)]",y?"hover:border-[color:var(--color-accent)]":"opacity-50"].join(" "),title:y?"Clear selection (".concat(y,")"):"Clear selection",children:(0,r.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:[(0,r.jsx)("path",{d:"M18 6L6 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,r.jsx)("path",{d:"M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})})]})]})]})]})}},9583:function(){}},function(e){e.O(0,[292,224,945,314,610,971,117,744],function(){return e(e.s=5207)}),_N_E=e.O()}]);